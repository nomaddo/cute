# Result

## 概要（詳しくない方向け）

この実験は、将棋の対局データから「評価値が一定のしきい値に最初に到達した側（first-crossed）」が勝ちやすいかどうかを調べたものです。評価値は先手視点で正とし、先手・後手を合算して分析しています。

### 何をしたか

- 24のレート戦の対局データを使い、評価値が 300/500/1000 を最初に超えた側と勝敗の関係を集計。
- レーティング差と first-crossed の影響をロジスティック回帰で推定。
- レーティング帯ごとの「first-crossed した側の勝率」を単純集計で確認。

### 何が言えるか

- どのしきい値でも、first-crossed した側の勝率が高い傾向が見られます。
- しきい値が大きいほど（300 < 500 < 1000）、first-crossed の効果が強く出ています。

### 注意点（解釈の範囲）

- これは因果関係の証明ではなく、「有利な局面になった側が勝ちやすい」という直感的な関係を定量化したものです。
- レーティング差を考慮しても first-crossed の効果は残りますが、データの偏りや局面評価の精度に依存します。
- 高いレーティング帯はサンプル数が少ないため、末尾の帯はばらつきが大きくなります。

## 統計モデルの数値の見方（詳しくない方向け）

ここで出てくる数値は「勝ちやすさにどのくらい影響があるか」を大まかに見るためのものです。厳密な数学の理解がなくても、下のポイントだけ押さえれば読み取れます。

### coefficients (log-odds)

- 正の値ほど「勝ちやすくなる方向」、負の値ほど「勝ちにくくなる方向」です。
- 数字が大きいほど影響が強めですが、直感的には次の odds ratios の方が分かりやすいです。

### odds ratios (1.0 = no change)

- 1.0 より大きいと勝ちやすく、小さいと勝ちにくい方向です。
- 例えば 1.28 は「その要素があると勝ちやすさが上がる」と解釈できます。
- first_crossed の値が 1.0 より大きいほど、「先にしきい値を超えた側が勝ちやすい」ことを意味します。

### predicted win rates (rating diff = 0)

- レーティング差がないと仮定したときの勝率です。
- first-cross=1 と first-cross=0 の差が「first-crossed の影響の大きさ」を示します。

### expected win rates by rating (first-cross=1, rating diff = 0)

- first-crossed した前提で、レーティングが上がるとどのくらい勝率が上がるかを示します。
- レーティングが高い帯ほど勝率が高いのは自然なので、「伸び方の傾向」を見るのが目的です。

## 実行コマンド (logreg threshold=300)

```
/workspaces/cute $ go run ./cmd/logreg -input out/games_34105_eval.parquet -threshold 300 -max-abs-diff 200 -workers 1
```

## 出力

```
data:
  input: out/games_34105_eval.parquet
  threshold: 300
  rating-scale: 100
  samples: total=60742 (skipped=3604)
  max-abs-diff: 200
  workers: 1
model:
  features: intercept, rating_diff_scaled, first_crossed, rating_x_first
all model:
coefficients (log-odds):
  intercept = -0.240381
  rating_diff_scaled = 0.254414
  first_crossed = 0.148462
  rating_x_first = 0.035934
odds ratios (1.0 = no change):
  rating_diff_scaled = 1.2897
  first_crossed = 1.1600
  rating_x_first = 1.0366
predicted win rates (rating diff = 0):
  first-cross=1: 0.477
  first-cross=0: 0.440
expected win rates by rating (first-cross=1, rating diff = 0):
  rating=300: win_rate=0.504
  rating=600: win_rate=0.531
  rating=900: win_rate=0.558
  rating=1200: win_rate=0.584
  rating=1500: win_rate=0.610
  rating=1800: win_rate=0.635
  rating=2100: win_rate=0.660
  rating=2400: win_rate=0.684
```

### わかること（logreg threshold=300）

- first-crossed した側の勝率が、していない側より高い方向に出ています。
- レーティング差も勝率に影響しますが、first-crossed の効果はそれとは別に残っています。
- 300 点のしきい値は「有利になったら勝ちやすい」という傾向がすでに見える水準です。

## 実行コマンド (logreg threshold=500)

```
/workspaces/cute $ go run ./cmd/logreg -input out/games_34105_eval.parquet -threshold 500 -max-abs-diff 200 -workers 1
```

## 出力

```
data:
  input: out/games_34105_eval.parquet
  threshold: 500
  rating-scale: 100
  samples: total=60440 (skipped=3755)
  max-abs-diff: 200
  workers: 1
model:
  features: intercept, rating_diff_scaled, first_crossed, rating_x_first
all model:
coefficients (log-odds):
  intercept = -0.389673
  rating_diff_scaled = 0.234375
  first_crossed = 0.236913
  rating_x_first = 0.059889
odds ratios (1.0 = no change):
  rating_diff_scaled = 1.2641
  first_crossed = 1.2673
  rating_x_first = 1.0617
predicted win rates (rating diff = 0):
  first-cross=1: 0.462
  first-cross=0: 0.404
expected win rates by rating (first-cross=1, rating diff = 0):
  rating=300: win_rate=0.507
  rating=600: win_rate=0.551
  rating=900: win_rate=0.595
  rating=1200: win_rate=0.638
  rating=1500: win_rate=0.678
  rating=1800: win_rate=0.716
  rating=2100: win_rate=0.751
  rating=2400: win_rate=0.783
```

### わかること（logreg threshold=500）

- first-crossed の影響が 300 より強くなり、勝率差が広がっています。
- 「ある程度はっきり有利になった側が勝ちやすい」ことを示す結果です。
- しきい値が上がるほど、first-crossed の効果が強まる流れが見えます。

## 実行コマンド (logreg threshold=1000)

```
/workspaces/cute $ go run ./cmd/logreg -input out/games_34105_eval.parquet -threshold 1000 -max-abs-diff 200 -workers 1
```

## 出力

```
data:
  input: out/games_34105_eval.parquet
  threshold: 1000
  rating-scale: 100
  samples: total=59398 (skipped=4276)
  max-abs-diff: 200
  workers: 1
model:
  features: intercept, rating_diff_scaled, first_crossed, rating_x_first
all model:
coefficients (log-odds):
  intercept = -0.634602
  rating_diff_scaled = 0.204868
  first_crossed = 0.370197
  rating_x_first = 0.104747
odds ratios (1.0 = no change):
  rating_diff_scaled = 1.2274
  first_crossed = 1.4480
  rating_x_first = 1.1104
predicted win rates (rating diff = 0):
  first-cross=1: 0.434
  first-cross=0: 0.346
expected win rates by rating (first-cross=1, rating diff = 0):
  rating=300: win_rate=0.512
  rating=600: win_rate=0.590
  rating=900: win_rate=0.663
  rating=1200: win_rate=0.730
  rating=1500: win_rate=0.787
  rating=1800: win_rate=0.835
  rating=2100: win_rate=0.874
  rating=2400: win_rate=0.905
```

### わかること（logreg threshold=1000）

- first-crossed の効果がさらに強く、勝率差が最も大きくなっています。
- 1000 点まで評価値が振れる「明確な優勢」は、勝ちに直結しやすいと読み取れます。
- レーティング差の影響を考慮しても、first-crossed の影響は残ります。

---

## 実行コマンド (analyze)

```
/workspaces/cute $ go run ./cmd/analyze -input out/games_34105_eval.parquet -thresholds 300,500,1000
```

## 出力

```
threshold=300
player_rate,crossings,wins,win_rate
0-100,6,3,0.500000
100-200,270,163,0.603704
200-300,928,529,0.570043
300-400,1177,684,0.581138
400-500,1358,780,0.574374
500-600,1232,692,0.561688
600-700,1396,829,0.593840
700-800,1414,838,0.592645
800-900,1365,834,0.610989
900-1000,1225,726,0.592653
1000-1100,984,566,0.575203
1100-1200,1076,638,0.592937
1200-1300,979,568,0.580184
1300-1400,942,551,0.584926
1400-1500,798,465,0.582707
1500-1600,631,387,0.613312
1600-1700,684,411,0.600877
1700-1800,558,337,0.603943
1800-1900,474,281,0.592827
1900-2000,397,261,0.657431
2000-2100,332,211,0.635542
2100-2200,216,130,0.601852
2200-2300,164,96,0.585366
2300-2400,151,90,0.596026
2400-2500,90,64,0.711111
2500-2600,69,46,0.666667
2600-2700,49,32,0.653061
2700-2800,27,18,0.666667
2800-2900,15,14,0.933333
2900-3000,2,0,0.000000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000

threshold=500
player_rate,crossings,wins,win_rate
0-100,5,4,0.800000
100-200,274,171,0.624088
200-300,914,571,0.624726
300-400,1171,746,0.637062
400-500,1344,844,0.627976
500-600,1235,758,0.613765
600-700,1399,895,0.639743
700-800,1410,888,0.629787
800-900,1351,872,0.645448
900-1000,1215,798,0.656790
1000-1100,987,626,0.634245
1100-1200,1070,690,0.644860
1200-1300,977,604,0.618219
1300-1400,938,604,0.643923
1400-1500,791,529,0.668774
1500-1600,640,435,0.679688
1600-1700,666,430,0.645646
1700-1800,566,372,0.657244
1800-1900,468,316,0.675214
1900-2000,395,279,0.706329
2000-2100,328,215,0.655488
2100-2200,216,149,0.689815
2200-2300,159,101,0.635220
2300-2400,156,107,0.685897
2400-2500,87,66,0.758621
2500-2600,69,52,0.753623
2600-2700,49,35,0.714286
2700-2800,26,22,0.846154
2800-2900,15,13,0.866667
2900-3000,2,1,0.500000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000

threshold=1000
player_rate,crossings,wins,win_rate
0-100,6,6,1.000000
100-200,264,186,0.704545
200-300,904,632,0.699115
300-400,1152,831,0.721354
400-500,1325,957,0.722264
500-600,1200,835,0.695833
600-700,1379,1009,0.731690
700-800,1378,991,0.719158
800-900,1338,954,0.713004
900-1000,1191,852,0.715365
1000-1100,974,713,0.732033
1100-1200,1067,799,0.748828
1200-1300,955,690,0.722513
1300-1400,929,693,0.745963
1400-1500,775,589,0.760000
1500-1600,621,485,0.780998
1600-1700,658,501,0.761398
1700-1800,546,406,0.743590
1800-1900,465,363,0.780645
1900-2000,394,305,0.774112
2000-2100,315,231,0.733333
2100-2200,209,160,0.765550
2200-2300,172,129,0.750000
2300-2400,140,111,0.792857
2400-2500,92,76,0.826087
2500-2600,68,61,0.897059
2600-2700,45,37,0.822222
2700-2800,24,22,0.916667
2800-2900,18,16,0.888889
2900-3000,1,1,1.000000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000
```

### わかること（analyze）

- どのレーティング帯でも、first-crossed した側の勝率が $0.5$ を超える傾向があります。
- しきい値が高いほど勝率が高く、優勢度が大きいほど勝ちやすい流れが見えます。
- 高レーティング帯は件数が少なく、極端な値が出やすい点に注意が必要です。

---

## 実行コマンド (analyze ignore-first-moves=20)

```
/workspaces/cute $ go run ./cmd/analyze -input out/games_34105_eval.parquet -thresholds 300,500,1000 -ignore-first-moves 20
```

## 出力

```
threshold=300
player_rate,crossings,wins,win_rate
0-100,6,4,0.666667
100-200,270,168,0.622222
200-300,911,531,0.582876
300-400,1168,696,0.595890
400-500,1353,803,0.593496
500-600,1238,697,0.563005
600-700,1392,843,0.605603
700-800,1407,852,0.605544
800-900,1357,838,0.617539
900-1000,1215,749,0.616461
1000-1100,988,579,0.586032
1100-1200,1077,637,0.591458
1200-1300,979,565,0.577120
1300-1400,938,558,0.594883
1400-1500,796,473,0.594221
1500-1600,628,396,0.630573
1600-1700,682,417,0.611437
1700-1800,558,339,0.607527
1800-1900,476,285,0.598739
1900-2000,392,258,0.658163
2000-2100,333,214,0.642643
2100-2200,215,130,0.604651
2200-2300,163,96,0.588957
2300-2400,152,91,0.598684
2400-2500,90,64,0.711111
2500-2600,69,47,0.681159
2600-2700,49,32,0.653061
2700-2800,27,18,0.666667
2800-2900,15,14,0.933333
2900-3000,2,0,0.000000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000

threshold=500
player_rate,crossings,wins,win_rate
0-100,5,4,0.800000
100-200,271,172,0.634686
200-300,903,568,0.629014
300-400,1162,745,0.641136
400-500,1340,847,0.632090
500-600,1232,766,0.621753
600-700,1399,904,0.646176
700-800,1404,897,0.638889
800-900,1346,879,0.653046
900-1000,1212,800,0.660066
1000-1100,986,635,0.644016
1100-1200,1073,692,0.644921
1200-1300,978,603,0.616564
1300-1400,935,603,0.644920
1400-1500,788,528,0.670051
1500-1600,636,433,0.680818
1600-1700,667,433,0.649175
1700-1800,565,371,0.656637
1800-1900,467,316,0.676660
1900-2000,395,278,0.703797
2000-2100,327,214,0.654434
2100-2200,216,149,0.689815
2200-2300,159,101,0.635220
2300-2400,156,106,0.679487
2400-2500,87,66,0.758621
2500-2600,69,52,0.753623
2600-2700,49,35,0.714286
2700-2800,26,22,0.846154
2800-2900,15,13,0.866667
2900-3000,2,1,0.500000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000

threshold=1000
player_rate,crossings,wins,win_rate
0-100,6,6,1.000000
100-200,261,185,0.708812
200-300,895,621,0.693855
300-400,1150,832,0.723478
400-500,1321,954,0.722180
500-600,1198,836,0.697830
600-700,1379,1008,0.730964
700-800,1374,989,0.719796
800-900,1336,955,0.714820
900-1000,1187,851,0.716933
1000-1100,973,712,0.731757
1100-1200,1067,798,0.747891
1200-1300,955,690,0.722513
1300-1400,928,692,0.745690
1400-1500,773,587,0.759379
1500-1600,618,482,0.779935
1600-1700,658,501,0.761398
1700-1800,545,405,0.743119
1800-1900,464,363,0.782328
1900-2000,394,305,0.774112
2000-2100,315,231,0.733333
2100-2200,208,159,0.764423
2200-2300,172,129,0.750000
2300-2400,140,111,0.792857
2400-2500,92,76,0.826087
2500-2600,68,61,0.897059
2600-2700,45,37,0.822222
2700-2800,24,22,0.916667
2800-2900,18,16,0.888889
2900-3000,1,1,1.000000
3000-3100,1,1,1.000000
3100-3200,0,0,0.000000
```

### わかること（analyze ignore-first-moves=20）

- 序盤 20 手までの評価値を無視しても、first-crossed した側の勝率は $0.5$ を超える帯が多く、傾向は保たれています。
- crossings が少し減るため、序盤の一時的な優勢が除外され、勝率がわずかに上がる帯が見られます。
- ただし帯によってはほぼ変わらないため、効果は「小さめだが一貫している」程度と考えるのが安全です。

---

## 実行コマンド (stats)

```
/workspaces/cute $ go run ./cmd/stats -parquet out/games_34105_eval.parquet
```

## 出力

```
input parquet: out/games_34105_eval.parquet
failed files: 0
unique users: 10263
ratings: known=10259 unknown=0 (users without rating=4)
users with >= 2 games: 7610
rating range: 10-3122
rating distribution (bin size=100):
0-99,29
100-199,178
200-299,524
300-399,605
400-499,637
500-599,569
600-699,636
700-799,680
800-899,625
900-999,537
1000-1099,460
1100-1199,498
1200-1299,496
1300-1399,505
1400-1499,423
1500-1599,346
1600-1699,389
1700-1799,340
1800-1899,301
1900-1999,289
2000-2099,270
2100-2199,211
2200-2299,176
2300-2399,148
2400-2499,111
2500-2599,105
2600-2699,69
2700-2799,58
2800-2899,26
2900-2999,15
3000-3099,2
3100-3199,1
```

### わかること（stats）

- 実験に使ったデータの規模感（利用者数・レーティング分布）が分かります。
- レーティング帯ごとの人数の偏りが見えるため、結果の安定度の参考になります。
- 高レーティング帯は人数が少ないので、そこでの勝率はぶれやすいことが確認できます。
